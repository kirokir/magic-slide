<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Viewport updated for zoom -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, maximum-scale=5.0">
    
    <!-- PWA Manifest and Theme Color -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#e0e5ec">

    <title>Advanced Catalog Builder</title>
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>
    
    <!-- Local Stylesheet -->
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div id="app-container" class="app-container">
    <!-- Header Bar -->
    <header class="header-bar">
        <div class="logo-title">Catalog Builder</div>
        
        <!-- Desktop Page Tabs -->
        <div class="page-tabs-container desktop-only">
            <ul id="page-tabs" class="page-tabs"></ul>
        </div>
        <button id="add-page-btn" class="add-page-btn desktop-only" title="Add New Page" aria-label="Add New Page">+</button>
        
        <!-- Desktop Global Actions -->
        <div class="global-actions desktop-only">
            <button id="undo-btn" class="btn" title="Undo (Ctrl+Z)" aria-label="Undo">↶</button>
            <button id="redo-btn" class="btn" title="Redo (Ctrl+Y)" aria-label="Redo">↷</button>
            <div class="zoom-controls">
                <button id="zoom-out-btn" class="btn" aria-label="Zoom Out">-</button>
                <span id="zoom-display" style="margin: 0 10px; font-weight: bold;">100%</span>
                <button id="zoom-in-btn" class="btn" aria-label="Zoom In">+</button>
                <button id="zoom-fit-btn" class="btn" style="margin-left: 5px;" title="Fit to screen">Fit</button>
            </div>
            <button id="load-project-btn" class="btn">Load</button>
            <input type="file" id="load-project-input" accept=".json" style="display:none;">
            <button id="save-project-btn" class="btn" title="Save Project (Ctrl+S)">Save</button>
            <div class="dropdown">
                <button class="btn btn-primary">Export</button>
                <div id="export-dropdown" class="dropdown-content">
                    <a href="#" id="export-png-btn">Export Current Page (PNG)</a>
                    <a href="#" id="export-jpeg-btn">Export Current Page (JPEG)</a>
                    <a href="#" id="export-pdf-btn">Export All Pages (PDF)</a>
                </div>
            </div>
        </div>

        <!-- Mobile Header Actions -->
        <div class="mobile-header-actions mobile-only">
            <select id="mobile-page-switcher" class="mobile-page-switcher"></select>
            <button id="mobile-toggle-inspector" class="mobile-icon-btn" title="Toggle Inspector">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24"><path d="M17.25,2.75a.75.75,0,0,0-.75.75v1.5H7.5V3.5a.75.75,0,0,0-1.5,0v1.5H3.5a.75.75,0,0,0,0,1.5h2.5V8H3.5a.75.75,0,0,0,0,1.5h2.5v2.5H3.5a.75.75,0,0,0,0,1.5h2.5v2.5H3.5a.75.75,0,0,0,0,1.5h2.5V20.5a.75.75,0,0,0,1.5,0V18.5h9V20.5a.75.75,0,0,0,1.5,0V18.5h2.5a.75.75,0,0,0,0-1.5H18V14.5h2.5a.75.75,0,0,0,0-1.5H18V10.5h2.5a.75.75,0,0,0,0-1.5H18V6.5h2.5a.75.75,0,0,0,0-1.5H18V3.5A.75.75,0,0,0,17.25,2.75ZM16.5,17H7.5V6.5h9Z"></path></svg>
            </button>
            <div class="dropdown" id="mobile-menu-dropdown">
                <button id="mobile-more-actions" class="mobile-icon-btn" title="More Actions">
                     <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24"><path d="M12,10a2,2,0,1,0,2,2A2,2,0,0,0,12,10ZM12,4a2,2,0,1,0,2,2A2,2,0,0,0,12,4Zm0,12a2,2,0,1,0,2,2A2,2,0,0,0,12,16Z"></path></svg>
                </button>
                <div class="dropdown-content">
                    <a href="#" id="mobile-add-page-btn"><svg viewBox="0 0 24 24"><path d="M19,11H13V5a1,1,0,0,0-2,0v6H5a1,1,0,0,0,0,2h6v6a1,1,0,0,0,2,0V13h6a1,1,0,0,0,0-2Z"/></svg>Add New Page</a>
                    <a href="#" id="mobile-undo-btn"><svg viewBox="0 0 24 24"><path d="M19.74,13a1,1,0,0,0-.32-.73L15,8.87a1,1,0,0,0-1.41,1.41L15.59,12H10a4,4,0,0,1-4-4V7a1,1,0,0,0-2,0V8a6,6,0,0,0,6,6h5.59l-2,2.12a1,1,0,0,0,0,1.42,1,1,0,0,0,.71.29,1,1,0,0,0,.7-.29l4.43-4.27A1,1,0,0,0,19.74,13Z"/></svg>Undo</a>
                    <a href="#" id="mobile-redo-btn"><svg viewBox="0 0 24 24"><path d="M20,8a6,6,0,0,0-6-6V1a1,1,0,0,0-2,0V2a4,4,0,0,1,4,4h0v1H8.41l2-2.12a1,1,0,0,0-1.41-1.41L4.26,8.27a1,1,0,0,0,0,1.46l4.74,4.27a1,1,0,0,0,.7.29,1,1,0,0,0,.71-.29,1,1,0,0,0,0-1.42L8.41,10H14a1,1,0,0,0,0-2Z"/></svg>Redo</a>
                    <a href="#" id="mobile-load-btn"><svg viewBox="0 0 24 24"><path d="M20.5,6.5h-5a1,1,0,0,1-1-1v-5a1,1,0,0,0-2,0v5a1,1,0,0,1-1,1h-5a1,1,0,0,0,0,2h5a1,1,0,0,1,1,1v5a1,1,0,0,0,2,0v-5a1,1,0,0,1,1-1h5a1,1,0,0,0,0-2Z M12,14.5H7a1,1,0,0,0-1,1v5a1,1,0,0,0,2,0v-4h4a1,1,0,0,0,0-2Z"/></svg>Load Project</a>
                    <a href="#" id="mobile-save-btn"><svg viewBox="0 0 24 24"><path d="M18.9,8.21a1,1,0,0,0-1.42,0l-6.23,6.22a1,1,0,0,1-1.41,0L6.53,11.12a1,1,0,0,0-1.41,1.41l3.31,3.32a3,3,0,0,0,4.24,0l6.23-6.22A1,1,0,0,0,18.9,8.21Z M12,2A10,10,0,1,0,22,12,10,10,0,0,0,12,2Zm0,18a8,8,0,1,1,8-8A8,8,0,0,1,12,20Z"/></svg>Save Project</a>
                    <a href="#" id="mobile-export-pdf-btn"><svg viewBox="0 0 24 24"><path d="M20,10a1,1,0,0,0-1,1v6a1,1,0,0,1-1,1H6a1,1,0,0,1-1-1V11a1,1,0,0,0-2,0v6a3,3,0,0,0,3,3H18a3,3,0,0,0,3-3V11A1,1,0,0,0,20,10Z M12,15a1,1,0,0,0,.71-.29l4-4a1,1,0,0,0-1.42-1.42L13,11.59V3a1,1,0,0,0-2,0v8.59l-2.29-2.3a1,1,0,0,0-1.42,1.42l4,4A1,1,0,0,0,12,15Z"/></svg>Export as PDF</a>
                </div>
            </div>
        </div>
    </header>

    <main class="main-content">
        <aside id="inspector-panel" class="inspector-panel">
            <button id="mobile-close-inspector" class="mobile-only mobile-icon-btn close-inspector-btn" title="Close Inspector">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24"><path d="M13.41,12l4.3-4.29a1,1,0,1,0-1.42-1.42L12,10.59,7.71,6.29A1,1,0,0,0,6.29,7.71L10.59,12l-4.3,4.29a1,1,0,0,0,0,1.42,1,1,0,0,0,1.42,0L12,13.41l4.29,4.3a1,1,0,0,0,1.42,0,1,1,0,0,0,0-1.42Z"></path></svg>
            </button>
        </aside>
        <section class="preview-panel" id="preview-panel">
            <div id="preview-canvas-wrapper" class="preview-canvas-wrapper">
                <div id="preview-canvas" class="preview-canvas"></div>
            </div>
        </section>
    </main>
</div>

<!-- All modals, toolbars, and overlays remain here -->
<div id="font-toolbar">
    <select id="font-family-select"><option>Arial</option><option>Verdana</option><option>Georgia</option><option>Times New Roman</option><option>Courier New</option><option>Impact</option></select>
    <input type="number" id="font-size-input" min="1" value="16">
    <input type="color" id="font-color-input" value="#000000">
</div>
<div id="template-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header"><h2 class="modal-title">Create Custom Template</h2><button class="close-modal-btn" aria-label="Close modal">×</button></div>
        <div class="inspector-group"><label for="template-name-input">Template Name</label><input type="text" id="template-name-input" placeholder="e.g., My Custom Cover"></div>
        <div class="inspector-group"><label for="template-type-select">Template Type</label><select id="template-type-select"><option value="static">Static (with {{placeholders}})</option><option value="interactive">Interactive (blank canvas)</option></select></div>
        <div class="inspector-group"><label for="template-html-input">HTML</label><textarea id="template-html-input" rows="8"></textarea></div>
        <div class="inspector-group"><label for="template-css-input">CSS</label><textarea id="template-css-input" rows="8"></textarea></div>
        <button id="save-template-btn" class="btn btn-primary">Save Template</button>
    </div>
</div>
<div id="loading-overlay" class="loading-overlay">
    <div class="spinner"></div><span id="loading-message">Generating PDF...</span>
</div>
<div id="toast-container"></div>

<!-- Main Application Script (the inline script has been removed) -->
<script src="app.js" type="module"></script>

</body>
</html>